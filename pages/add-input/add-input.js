(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/add-input/add-input"],{"30f5":function(t,n,i){"use strict";var e=i("7b24"),s=i.n(e);s.a},"7b24":function(t,n,i){},8974:function(t,n,i){"use strict";(function(t){i("2b3c"),i("921b");e(i("66fd"));var n=e(i("dade"));function e(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,i("543d")["createPage"])},ac26:function(t,n,i){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=s(i("a34a"));function s(t){return t&&t.__esModule?t:{default:t}}function a(t,n){return u(t)||o(t,n)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,n){var i=[],e=!0,s=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)if(i.push(r.value),n&&i.length===n)break}catch(u){s=!0,a=u}finally{try{e||null==o["return"]||o["return"]()}finally{if(s)throw a}}return i}function u(t){if(Array.isArray(t))return t}function c(t,n,i,e,s,a,r){try{var o=t[a](r),u=o.value}catch(c){return void i(c)}o.done?n(u):Promise.resolve(u).then(e,s)}function l(t){return function(){var n=this,i=arguments;return new Promise(function(e,s){var a=t.apply(n,i);function r(t){c(a,e,s,r,o,"next",t)}function o(t){c(a,e,s,r,o,"throw",t)}r(void 0)})}}var p=["仅自己可见","所有人可见"],d=function(){return i.e("components/uni-nav-bar/uni-nav-bar").then(i.bind(null,"b475"))},h=function(){return i.e("components/common/uploud-images").then(i.bind(null,"d386"))},f=function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"e8b3"))},g={components:{uniNavBar:d,uploudImages:h,uniPopup:f},data:function(){return{isget:!1,showpopup:!0,yinsi:1,text:"",imglist:[],imglistIds:[],postclass:{id:0,title:"",range:[],list:[]},topic:{id:0,title:""}}},onBackPress:function(){if(this.text||!(this.imglist.length<1))return this.isget?void 0:(this.baocun(),!0)},computed:{getType:function(){return p[this.yinsi]}},onLoad:function(n){var i=this,e=t.getStorageSync("addinput");e&&(e=JSON.parse(e),this.yinsi=e.yinsi,this.imglistIds=e.imglistIds||[],this.imglistIds.length&&(this.imglist=e.imglist),this.text=e.text,e.postclass&&(this.postclass=e.postclass),e.topic&&(this.topic=e.topic));var s=!!n.postclass&&JSON.parse(n.postclass);this.getPostClass(s),t.$on("changeTopic",function(t){i.topic.id=t.id,i.topic.title="#".concat(t.title,"#")})},methods:{changeTopic:function(){t.navigateTo({url:"/pages/topic-nav/topic-nav?ischange="+!0})},getPostClass:function(){var t=l(e.default.mark(function t(n){var i,s,r,o,u,c,l,p,d,h;return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=5;break}for(this.postclass.list=n,i=[],s=0;s<n.length;s++)i.push(n[s].name);return t.abrupt("return",this.postclass.range=i);case 5:return t.prev=5,t.next=8,this.$http.get("/postclass");case 8:if(r=t.sent,o=a(r,2),u=o[0],c=o[1],this.$http.errorCheck(u,c)){t.next=14;break}return t.abrupt("return");case 14:for(l=c.data.data.list,p=[],d=[],h=0;h<l.length;h++)p.push(l[h].classname),d.push({id:l[h].id,name:l[h].classname});this.postclass.range=p,this.postclass.list=d,t.next=24;break;case 21:return t.prev=21,t.t0=t["catch"](5),t.abrupt("return");case 24:case"end":return t.stop()}},t,this,[[5,21]])}));function n(n){return t.apply(this,arguments)}return n}(),changePostClass:function(t){console.log(t),this.postclass.id=this.postclass.list[t.target.value].id,this.postclass.title=this.postclass.list[t.target.value].name,console.log(this.postclass.list[t.target.value])},baocun:function(){var n=this;t.showModal({content:"是否要保存为草稿？",cancelText:"不保存",confirmText:"保存",success:function(i){if(i.confirm){var e={yinsi:n.yinsi,text:n.text,imglist:n.imglist,imglistIds:n.imglistIds,postclass:n.postclass,topic:n.topic};t.setStorageSync("addinput",JSON.stringify(e))}else t.removeStorage({key:"addinput"});n.isget=!0,t.navigateBack({delta:1})}})},back:function(){t.navigateBack({delta:1})},submit:function(){var n=l(e.default.mark(function n(){var i,s,r,o;return e.default.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(this.postclass.id){n.next=2;break}return n.abrupt("return",t.showToast({title:"请选择分类",icon:"none"}));case 2:return t.showLoading({title:"发布中...",mask:!0}),n.prev=3,n.next=6,this.$http.post("/post/create",{imglist:JSON.stringify(this.imglistIds),text:this.text,isopen:this.yinsi,topic_id:this.topic.id,post_class_id:this.postclass.id},{token:!0,checkToken:!0,checkAuth:!0});case 6:if(i=n.sent,s=a(i,2),r=s[0],o=s[1],this.$http.errorCheck(r,o)){n.next=12;break}return n.abrupt("return",t.hideLoading());case 12:t.hideLoading(),t.showToast({title:"发布成功！"}),this.isget=!0,t.$emit("updateData",{type:"updateList",data:o.data.data.detail}),t.navigateBack({delta:1}),n.next=22;break;case 19:return n.prev=19,n.t0=n["catch"](3),n.abrupt("return");case 22:case"end":return n.stop()}},n,this,[[3,19]])}));function i(){return n.apply(this,arguments)}return i}(),changelook:function(){var n=this;t.showActionSheet({itemList:p,success:function(t){n.yinsi=t.tapIndex}})},upload:function(t){this.imglist.push(t.url),this.imglistIds.push({id:t.id})},delImageList:function(t){this.imglist.splice(t,1),this.imglistIds.splice(t,1)},hidePopup:function(){this.showpopup=!1}}};n.default=g}).call(this,i("543d")["default"])},d98e:function(t,n,i){"use strict";var e={"uni-nav-bar":()=>i.e("components/uni-nav-bar/uni-nav-bar").then(i.bind(null,"b475")),"uni-popup":()=>i.e("components/uni-popup/uni-popup").then(i.bind(null,"e8b3"))},s=function(){var t=this,n=t.$createElement;t._self._c},a=[];i.d(n,"b",function(){return s}),i.d(n,"c",function(){return a}),i.d(n,"a",function(){return e})},dade:function(t,n,i){"use strict";i.r(n);var e=i("d98e"),s=i("fe44");for(var a in s)"default"!==a&&function(t){i.d(n,t,function(){return s[t]})}(a);i("30f5");var r,o=i("f0c5"),u=Object(o["a"])(s["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],r);n["default"]=u.exports},fe44:function(t,n,i){"use strict";i.r(n);var e=i("ac26"),s=i.n(e);for(var a in e)"default"!==a&&function(t){i.d(n,t,function(){return e[t]})}(a);n["default"]=s.a}},[["8974","common/runtime","common/vendor"]]]);